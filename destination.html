<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í¬ë£¨ì¦ˆë§í¬ - ëª©ì ì§€ë³„ í¬ë£¨ì¦ˆ</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš¢</text></svg>">
</head>
<body>
  <div id="header"></div>

  <section class="hero" style="padding: 48px 0 72px;">
    <div class="container">
      <h1 id="destTitle">í¬ë£¨ì¦ˆ ê²€ìƒ‰</h1>
      <p id="destSubtitle">ëª©ì ì§€ë³„ í¬ë£¨ì¦ˆë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
    </div>
  </section>

  <div class="container">
    <div class="filter-bar">
      <div class="filter-group">
        <label>ëª©ì ì§€</label>
        <select id="filterDest">
          <option value="">ì „ì²´</option>
          <option value="korea">í•œêµ­/ì¼ë³¸</option>
          <option value="mediterranean">ì§€ì¤‘í•´</option>
          <option value="alaska">ì•Œë˜ìŠ¤ì¹´</option>
          <option value="caribbean">ì¹´ë¦¬ë¸Œí•´</option>
          <option value="northern-europe">ë¶ìœ ëŸ½</option>
          <option value="southeast-asia">ë™ë‚¨ì•„ì‹œì•„</option>
          <option value="japan">ì¼ë³¸</option>
          <option value="hawaii">í•˜ì™€ì´</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ì„ ì‚¬</label>
        <select id="filterOperator">
          <option value="">ì „ì²´</option>
          <option value="MSC">MSC Cruises</option>
          <option value="Norwegian">Norwegian Cruise Line</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ì¶œë°œì›”</label>
        <select id="filterMonth"><option value="">ì „ì²´</option></select>
      </div>
      <div class="filter-group">
        <label>ê¸°ê°„</label>
        <select id="filterDuration">
          <option value="">ì „ì²´</option>
          <option value="short">1~5ë°•</option>
          <option value="medium">6~10ë°•</option>
          <option value="long">11ë°• ì´ìƒ</option>
        </select>
      </div>
      <button class="btn btn-orange" onclick="applyFilters()">ğŸ” ê²€ìƒ‰</button>
    </div>
  </div>

  <section class="section">
    <div class="container">
      <p class="section-subtitle" id="resultCount"></p>
      <div id="cruiseList" class="cruise-list">
        <div class="loading"><div class="loading-spinner"></div><p>í¬ë£¨ì¦ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
      </div>
      <div id="pagination" class="pagination"></div>
    </div>
  </section>

  <div id="ctaSection"></div>
  <div id="footer"></div>

  <script src="assets/data/translations.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/components.js"></script>
  <script>
    document.getElementById('header').innerHTML = Components.header('dest');
    document.getElementById('footer').innerHTML = Components.footer();
    document.getElementById('ctaSection').innerHTML = Components.ctaSection();

    const params = new URLSearchParams(location.search);
    const dest = params.get('dest') || '';
    const PER_PAGE = 10;
    let currentPage = 1;
    let allResults = [];

    if (dest) document.getElementById('filterDest').value = dest;
    if (params.get('operator')) document.getElementById('filterOperator').value = params.get('operator');
    if (params.get('duration')) document.getElementById('filterDuration').value = params.get('duration');

    if (dest && Translations.destNameKo[dest]) {
      document.getElementById('destTitle').textContent = Translations.destNameKo[dest] + ' í¬ë£¨ì¦ˆ';
      document.getElementById('destSubtitle').textContent = `${Translations.destNameKo[dest]} ì§€ì—­ì˜ í¬ë£¨ì¦ˆ ìƒí’ˆì„ í™•ì¸í•˜ì„¸ìš”`;
      document.title = `${Translations.destNameKo[dest]} í¬ë£¨ì¦ˆ - í¬ë£¨ì¦ˆë§í¬`;
    }

    const monthSelect = document.getElementById('filterMonth');
    const now = new Date();
    for (let i = 0; i < 24; i++) {
      const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
      const val = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
      monthSelect.innerHTML += `<option value="${val}">${d.getFullYear()}ë…„ ${d.getMonth() + 1}ì›”</option>`;
    }
    if (params.get('month')) monthSelect.value = params.get('month');

    async function loadCruises() {
      const container = document.getElementById('cruiseList');
      container.innerHTML = Components.loading();

      try {
        allResults = await API.filterCruises({
          dest: document.getElementById('filterDest').value,
          operator: document.getElementById('filterOperator').value,
          month: document.getElementById('filterMonth').value,
          duration: document.getElementById('filterDuration').value,
        });
        currentPage = 1;
        renderPage();
      } catch (e) {
        console.error(e);
        container.innerHTML = '<div class="empty-state"><span class="emoji">âš ï¸</span><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p></div>';
      }
    }

    function renderPage() {
      const container = document.getElementById('cruiseList');
      const pagination = document.getElementById('pagination');
      const countEl = document.getElementById('resultCount');

      countEl.textContent = `ì´ ${allResults.length}ê°œì˜ í¬ë£¨ì¦ˆ`;

      if (allResults.length === 0) {
        container.innerHTML = '<div class="empty-state"><span class="emoji">ğŸ”</span><p>ì¡°ê±´ì— ë§ëŠ” í¬ë£¨ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</p></div>';
        pagination.innerHTML = '';
        return;
      }

      const totalPages = Math.ceil(allResults.length / PER_PAGE);
      const start = (currentPage - 1) * PER_PAGE;
      const pageItems = allResults.slice(start, start + PER_PAGE);

      container.innerHTML = pageItems.map(c => Components.localCruiseItem(c)).join('');

      if (totalPages > 1) {
        let html = '';
        const maxVisible = 10;
        let startP = Math.max(1, currentPage - Math.floor(maxVisible / 2));
        let endP = startP + maxVisible - 1;
        if (endP > totalPages) { endP = totalPages; startP = Math.max(1, endP - maxVisible + 1); }
        if (startP > 1) html += `<button class="page-btn" onclick="goPage(1)">1</button><span class="page-ellipsis">â€¦</span>`;
        for (let i = startP; i <= endP; i++) {
          html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goPage(${i})">${i}</button>`;
        }
        if (endP < totalPages) html += `<span class="page-ellipsis">â€¦</span><button class="page-btn" onclick="goPage(${totalPages})">${totalPages}</button>`;
        pagination.innerHTML = html;
      } else {
        pagination.innerHTML = '';
      }
    }

    function goPage(p) {
      currentPage = p;
      renderPage();
      window.scrollTo({ top: 300, behavior: 'smooth' });
    }

    function applyFilters() {
      const d = document.getElementById('filterDest').value;
      const op = document.getElementById('filterOperator').value;
      const m = document.getElementById('filterMonth').value;
      const dur = document.getElementById('filterDuration').value;
      let url = 'destination.html?';
      if (d) url += `dest=${d}&`;
      if (op) url += `operator=${op}&`;
      if (m) url += `month=${m}&`;
      if (dur) url += `duration=${dur}&`;
      location.href = url.slice(0, -1);
    }

    loadCruises();
  </script>
  
  <div class="modal-overlay" id="inquiryModal">
    <div class="modal">
      <div class="modal-header"><h2>ğŸš¢ í¬ë£¨ì¦ˆ ë¬¸ì˜í•˜ê¸°</h2><button class="modal-close" onclick="closeInquiry()">&times;</button></div>
      <div class="modal-body">
        <div class="form-status" id="formStatus"></div>
        <form id="inquiryForm" onsubmit="submitInquiry(event)">
          <input type="hidden" name="_subject" value="[í¬ë£¨ì¦ˆë§í¬] ìƒˆ ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤">
          <input type="hidden" name="_template" value="table">
          <input type="text" name="_honey" style="display:none">
          <div class="form-group"><label>ì˜ë¬¸ ì´ë¦„ (ì—¬ê¶Œ ê¸°ì¬ëª…) <span class="req">*</span></label><input type="text" name="customer_name" required placeholder="HONG GILDONG"></div>
          <div class="form-group"><label>ì´ë©”ì¼ <span class="req">*</span></label><input type="email" name="customer_email" required placeholder="example@email.com"></div>
          <div class="form-group"><label>ì—°ë½ì²˜ <span class="req">*</span></label><input type="tel" name="customer_phone" required placeholder="010-1234-5678"></div>
          <div class="form-group"><label>ê´€ì‹¬ í¬ë£¨ì¦ˆ / ìš”ì²­ì‚¬í•­ <span class="req">*</span></label><textarea name="message" rows="3" required placeholder="ê´€ì‹¬ ìˆëŠ” í¬ë£¨ì¦ˆë‚˜ ì—¬í–‰ ì¼ì •ì„ ì•Œë ¤ì£¼ì„¸ìš”."></textarea></div>
          <div class="privacy-section">
            <div class="privacy-check"><input type="checkbox" id="privacyAgree2" required><label for="privacyAgree2">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</label></div>
            <button type="button" class="privacy-toggle" onclick="document.getElementById('privacyDetail').classList.toggle('open')">ì•½ê´€ ë³´ê¸° â–¼</button>
            <div class="privacy-detail" id="privacyDetail"><strong>ìˆ˜ì§‘í•­ëª©:</strong> ì´ë¦„, ì´ë©”ì¼, ì—°ë½ì²˜<br><strong>ìˆ˜ì§‘ëª©ì :</strong> í¬ë£¨ì¦ˆ ìƒë‹´ ë° ì˜ˆì•½ ì•ˆë‚´<br><strong>ë³´ìœ ê¸°ê°„:</strong> ìƒë‹´ ì™„ë£Œ í›„ 1ë…„</div>
          </div>
          <button type="submit" class="btn btn-orange" id="submitBtn" style="width:100%;margin-top:16px;padding:14px;font-size:1.05rem">ë¬¸ì˜í•˜ê¸° ì „ì†¡</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    function openInquiryWith(title, operator, ship, dateFrom, nights, price, ref, currency) {
      document.getElementById('modalProductName').textContent = title;
      document.getElementById('modalProductDetail').innerHTML =
        `${operator} Â· ${ship}<br>ì¶œë°œ: ${dateFrom} / ${nights}ë°•${price ? (currency==='EUR'?' / â‚¬':' / $')+price+'~' : ''}`;
      document.getElementById('f_product').value = title;
      document.getElementById('f_cruiseline').value = operator;
      document.getElementById('f_ship').value = ship;
      document.getElementById('f_date').value = dateFrom;
      document.getElementById('f_ports').value = '';
      document.getElementById('f_price').value = price ? (currency==='EUR'?'â‚¬':'$')+price+'~' : 'ë¬¸ì˜';
      document.getElementById('f_ref').value = ref;
      document.getElementById('inquiryModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function openInquiry() {
      document.getElementById('modalProductName').textContent = '';
      document.getElementById('modalProductDetail').innerHTML = '';
      document.getElementById('f_product').value = '';
      document.getElementById('f_cruiseline').value = '';
      document.getElementById('f_ship').value = '';
      document.getElementById('f_date').value = '';
      document.getElementById('f_ports').value = '';
      document.getElementById('f_price').value = '';
      document.getElementById('f_ref').value = '';
      document.getElementById('inquiryModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeInquiry() {
      document.getElementById('inquiryModal').classList.remove('open');
      document.body.style.overflow = '';
    }
    document.addEventListener('click', e => { if (e.target.id === 'inquiryModal') closeInquiry(); });
    function submitInquiry(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true; btn.textContent = 'ì „ì†¡ ì¤‘...';
      const fd = {
        _subject: `[í¬ë£¨ì¦ˆë§í¬] ${document.getElementById('f_product').value} - ${document.getElementById('f_name').value}ë‹˜`,
        _template: 'table',
        'í¬ë£¨ì¦ˆ ìƒí’ˆ': document.getElementById('f_product').value,
        'ì„ ì‚¬': document.getElementById('f_cruiseline').value,
        'ì„ ë°•': document.getElementById('f_ship').value,
        'ì¶œë°œì¼': document.getElementById('f_date').value,
        'ì°¸ê³ ê°€ê²©': document.getElementById('f_price').value,
        'Ref': document.getElementById('f_ref').value,
        'ê³ ê° ì´ë¦„': document.getElementById('f_name').value,
        'ê³ ê° ì´ë©”ì¼': document.getElementById('f_email').value,
        'ê³ ê° ì—°ë½ì²˜': document.getElementById('f_phone').value,
        'ì¸ì›': document.getElementById('f_pax').value,
        'í¬ë§ ê°ì‹¤': document.getElementById('f_cabin').value,
        'ìš”ì²­ì‚¬í•­': document.getElementById('f_message').value || 'ì—†ìŒ',
      };
      const data = new FormData();
      Object.entries(fd).forEach(([k,v]) => data.append(k,v));
      fetch('https://formsubmit.co/ajax/info@cruiselink.co.kr', { method:'POST', body:data })
      .then(() => {
        document.getElementById('formStatus').innerHTML = '<div style="background:#e8f5e9;padding:12px;border-radius:8px;color:#2e7d32;font-size:0.9rem">âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ê²¬ì ì„œë¥¼ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('inquiryForm').style.display = 'none'; btn.style.display = 'none';
      }).catch(() => {
        document.getElementById('formStatus').innerHTML = '<div style="background:#e8f5e9;padding:12px;border-radius:8px;color:#2e7d32;font-size:0.9rem">âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ê²¬ì ì„œë¥¼ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('inquiryForm').style.display = 'none'; btn.style.display = 'none';
      });
    }
  </script>
  <div class="modal-overlay" id="inquiryModal">
    <div class="modal" style="max-width:460px">
      <div class="modal-header" style="padding:14px 20px">
        <h2 style="font-size:1.05rem">ğŸš¢ í¬ë£¨ì¦ˆ ë¬¸ì˜í•˜ê¸°</h2>
        <button class="modal-close" onclick="closeInquiry()">&times;</button>
      </div>
      <div class="modal-body" style="padding:16px 20px">
        <div class="modal-product-info" style="padding:10px 12px;margin-bottom:12px;font-size:0.88rem;background:#f5f5f5;border-radius:8px">
          <strong id="modalProductName"></strong><br>
          <span id="modalProductDetail" style="color:#666"></span>
        </div>
        <div class="form-status" id="formStatus"></div>
        <form id="inquiryForm" onsubmit="submitInquiry(event)">
          <input type="hidden" id="f_product" name="product_name">
          <input type="hidden" id="f_cruiseline" name="cruise_line">
          <input type="hidden" id="f_ship" name="ship">
          <input type="hidden" id="f_date" name="departure_date">
          <input type="hidden" id="f_ports" name="ports">
          <input type="hidden" id="f_price" name="price">
          <input type="hidden" id="f_ref" name="cruise_ref">
          <input type="text" name="_honey" style="display:none">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì´ë¦„ <span class="req">*</span></label>
              <input type="text" id="f_name" name="customer_name" required placeholder="í™ê¸¸ë™" style="padding:8px 10px;font-size:0.9rem">
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì—°ë½ì²˜ <span class="req">*</span></label>
              <input type="tel" id="f_phone" name="customer_phone" required placeholder="010-1234-5678" style="padding:8px 10px;font-size:0.9rem">
            </div>
          </div>
          <div class="form-group" style="margin-bottom:8px">
            <label style="font-size:0.8rem;margin-bottom:3px">ì´ë©”ì¼ <span class="req">*</span></label>
            <input type="email" id="f_email" name="customer_email" required placeholder="example@email.com" style="padding:8px 10px;font-size:0.9rem">
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì¸ì› <span class="req">*</span></label>
              <select id="f_pax" name="pax" required style="padding:8px 10px;font-size:0.9rem">
                <option value="">ì„ íƒ</option>
                <option value="1">1ëª…</option><option value="2">2ëª…</option><option value="3">3ëª…</option>
                <option value="4">4ëª…</option><option value="5">5ëª…</option><option value="6~10">6~10ëª…</option>
                <option value="11+">11ëª… ì´ìƒ</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ê°ì‹¤ íƒ€ì… <span class="req">*</span></label>
              <select id="f_cabin" name="cabin_type" required style="padding:8px 10px;font-size:0.9rem">
                <option value="">ì„ íƒ</option>
                <option value="ë‚´ì¸¡">ë‚´ì¸¡</option>
                <option value="ì˜¤ì…˜ë·°">ì˜¤ì…˜ë·°</option>
                <option value="ë°œì½”ë‹ˆ">ë°œì½”ë‹ˆ</option>
                <option value="ìŠ¤ìœ„íŠ¸">ìŠ¤ìœ„íŠ¸</option>
              </select>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:8px">
            <label style="font-size:0.8rem;margin-bottom:3px">ìš”ì²­ì‚¬í•­</label>
            <textarea id="f_message" name="message" rows="2" placeholder="ê¸°íƒ€ ìš”ì²­ì‚¬í•­" style="padding:8px 10px;font-size:0.9rem"></textarea>
          </div>
          <div class="privacy-section" style="margin-top:8px;padding-top:8px">
            <div class="privacy-check" style="margin-bottom:4px">
              <input type="checkbox" id="privacyAgree" required style="width:16px;height:16px">
              <label for="privacyAgree" style="font-size:0.8rem">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</label>
            </div>
            <button type="button" class="privacy-toggle" style="font-size:0.78rem" onclick="document.getElementById('privacyDetail').classList.toggle('open')">ì•½ê´€ ë³´ê¸° â–¼</button>
            <div class="privacy-detail" id="privacyDetail">
              <strong>ìˆ˜ì§‘í•­ëª©:</strong> ì´ë¦„, ì´ë©”ì¼, ì—°ë½ì²˜<br>
              <strong>ìˆ˜ì§‘ëª©ì :</strong> í¬ë£¨ì¦ˆ ìƒë‹´ ë° ì˜ˆì•½ ì•ˆë‚´<br>
              <strong>ë³´ìœ ê¸°ê°„:</strong> ìƒë‹´ ì™„ë£Œ í›„ 1ë…„
            </div>
          </div>
          <button type="submit" class="btn btn-orange" id="submitBtn" style="width:100%;margin-top:10px;padding:12px;font-size:1rem">ë¬¸ì˜í•˜ê¸° ì „ì†¡</button>
        </form>
      </div>
    </div>
  </div>

</body>
</html>
