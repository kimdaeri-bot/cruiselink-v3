<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²€ìƒ‰ ê²°ê³¼ - í¬ë£¨ì¦ˆë§í¬</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš¢</text></svg>">
  <style>
    .search-hero { background: var(--navy); color: #fff; padding: 32px 0; text-align: center; }
    .search-hero h1 { font-size: 1.6rem; font-weight: 900; margin-bottom: 8px; }
    .search-hero p { opacity: 0.8; font-size: 0.95rem; }
    .search-tags { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 16px; }
    .search-tag { background: rgba(255,255,255,0.15); padding: 4px 14px; border-radius: 20px; font-size: 0.85rem; }
    .search-loading { text-align: center; padding: 80px 20px; }
    .search-loading .loading-spinner { width: 48px; height: 48px; border-width: 4px; margin: 0 auto 16px; }
    .search-progress { width: 280px; height: 4px; background: var(--gray-200); border-radius: 2px; margin: 20px auto 0; overflow: hidden; }
    .search-progress-bar { height: 100%; background: var(--orange); border-radius: 2px; width: 0%; transition: width 0.3s ease; }
    .search-status { font-size: 0.9rem; color: var(--gray-500); margin-top: 12px; }
    .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 12px; }
    .result-count { font-size: 1.1rem; font-weight: 700; color: var(--navy); }
    .result-count span { color: var(--orange); }
  </style>
</head>
<body>
  <div id="header"></div>

  <div class="search-hero">
    <div class="container">
      <h1>ğŸ” í¬ë£¨ì¦ˆ ê²€ìƒ‰ ê²°ê³¼</h1>
      <p id="searchSummary">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” í¬ë£¨ì¦ˆë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>
      <div class="search-tags" id="searchTags"></div>
    </div>
  </div>

  <section class="section" style="background: var(--gray-50); min-height: 400px;">
    <div class="container">
      <!-- Loading state -->
      <div id="loadingState" class="search-loading">
        <div class="loading-spinner"></div>
        <p style="font-size:1.1rem; font-weight:700; color:var(--navy);">ì‹¤ì‹œê°„ í¬ë£¨ì¦ˆ ê²€ìƒ‰ ì¤‘...</p>
        <div class="search-progress"><div class="search-progress-bar" id="progressBar"></div></div>
        <p class="search-status" id="statusText">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤</p>
      </div>
      <!-- Results -->
      <div id="resultArea" style="display:none;">
        <div class="result-header">
          <div class="result-count" id="resultCount"></div>
        </div>
        <div id="resultList" class="cruise-list"></div>
        <div id="pagination" class="pagination"></div>
      </div>
    </div>
  </section>

  <div id="ctaSection"></div>
  <div id="footer"></div>

  <script src="assets/data/translations.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/components.js"></script>
  <script>
    document.getElementById('header').innerHTML = Components.header();
    document.getElementById('footer').innerHTML = Components.footer();
    document.getElementById('ctaSection').innerHTML = Components.ctaSection();

    const params = new URLSearchParams(location.search);
    const dest = params.get('dest') || '';
    const operators = params.get('operators') ? params.get('operators').split(',') : [];
    const ports = params.get('ports') ? params.get('ports').split(',') : [];
    const month = params.get('month') || '';
    const duration = params.get('duration') || '';

    // Show search tags
    const tagsEl = document.getElementById('searchTags');
    const destNames = {'korea':'í•œêµ­/ì¼ë³¸','mediterranean':'ì§€ì¤‘í•´','alaska':'ì•Œë˜ìŠ¤ì¹´','caribbean':'ì¹´ë¦¬ë¸Œí•´','northern-europe':'ë¶ìœ ëŸ½','asia':'ì•„ì‹œì•„/ì¤‘ë™','south-america':'ë‚¨ë¯¸','oceania':'ì˜¤ì„¸ì•„ë‹ˆì•„','hawaii':'í•˜ì™€ì´'};
    const durNames = {'short':'1~5ë°•','medium':'6~10ë°•','long':'11ë°• ì´ìƒ'};
    if (dest) tagsEl.innerHTML += `<span class="search-tag">ğŸ“ ${destNames[dest]||dest}</span>`;
    ports.forEach(p => tagsEl.innerHTML += `<span class="search-tag">ğŸš¢ ${p}</span>`);
    operators.forEach(o => tagsEl.innerHTML += `<span class="search-tag">âš“ ${Translations.operatorName(o==='MSC'?'MSC Cruises':'Norwegian Cruise Line')}</span>`);
    if (month) tagsEl.innerHTML += `<span class="search-tag">ğŸ“… ${month.replace('-','ë…„ ')}ì›”</span>`;
    if (duration) tagsEl.innerHTML += `<span class="search-tag">â±ï¸ ${durNames[duration]||duration}</span>`;

    // Animated loading
    const bar = document.getElementById('progressBar');
    const statusText = document.getElementById('statusText');
    const steps = [
      [20, '6,000+ í¬ë£¨ì¦ˆ ë°ì´í„° ë¡œë”© ì¤‘...'],
      [50, 'ì¡°ê±´ì— ë§ëŠ” í¬ë£¨ì¦ˆ í•„í„°ë§ ì¤‘...'],
      [80, 'ê°€ê²© ë° ì¼ì • ì •ë³´ í™•ì¸ ì¤‘...'],
      [95, 'ê²°ê³¼ ì •ë ¬ ì¤‘...'],
    ];

    let allResults = [];
    const PER_PAGE = 20;
    let currentPage = 1;

    async function doSearch() {
      // Animate progress
      for (const [pct, text] of steps) {
        bar.style.width = pct + '%';
        statusText.textContent = text;
        await new Promise(r => setTimeout(r, 400));
      }

      const results = await API.filterCruises({ dest, operators, ports, month, duration, limit: 9999 });
      allResults = results;

      bar.style.width = '100%';
      statusText.textContent = 'ì™„ë£Œ!';
      await new Promise(r => setTimeout(r, 300));

      // Show results
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('resultArea').style.display = 'block';
      document.getElementById('resultCount').innerHTML = `ì´ <span>${results.length}</span>ê°œì˜ í¬ë£¨ì¦ˆë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤`;
      document.getElementById('searchSummary').textContent = `${results.length}ê°œì˜ í¬ë£¨ì¦ˆê°€ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤`;
      document.title = `ê²€ìƒ‰ ê²°ê³¼ (${results.length}ê±´) - í¬ë£¨ì¦ˆë§í¬`;

      renderPage();
    }

    function renderPage() {
      const container = document.getElementById('resultList');
      const pagination = document.getElementById('pagination');

      if (allResults.length === 0) {
        container.innerHTML = '<div class="empty-state"><span class="emoji">ğŸ”</span><p>ì¡°ê±´ì— ë§ëŠ” í¬ë£¨ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.<br>ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•´ ë³´ì„¸ìš”.</p></div>';
        pagination.innerHTML = '';
        return;
      }

      const totalPages = Math.ceil(allResults.length / PER_PAGE);
      const start = (currentPage - 1) * PER_PAGE;
      const pageItems = allResults.slice(start, start + PER_PAGE);

      container.innerHTML = pageItems.map(c => Components.localCruiseItem(c)).join('');

      if (totalPages > 1) {
        let html = '';
        const maxVisible = 10;
        let startP = Math.max(1, currentPage - Math.floor(maxVisible / 2));
        let endP = startP + maxVisible - 1;
        if (endP > totalPages) { endP = totalPages; startP = Math.max(1, endP - maxVisible + 1); }
        if (startP > 1) html += `<button class="page-btn" onclick="goPage(1)">1</button><span class="page-ellipsis">â€¦</span>`;
        for (let i = startP; i <= endP; i++) {
          html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goPage(${i})">${i}</button>`;
        }
        if (endP < totalPages) html += `<span class="page-ellipsis">â€¦</span><button class="page-btn" onclick="goPage(${totalPages})">${totalPages}</button>`;
        pagination.innerHTML = html;
      } else {
        pagination.innerHTML = '';
      }
    }

    function goPage(p) {
      currentPage = p;
      renderPage();
      window.scrollTo({ top: 200, behavior: 'smooth' });
    }

    doSearch();
  </script>
  
  <div class="modal-overlay" id="inquiryModal">
    <div class="modal">
      <div class="modal-header"><h2>ğŸš¢ í¬ë£¨ì¦ˆ ë¬¸ì˜í•˜ê¸°</h2><button class="modal-close" onclick="closeInquiry()">&times;</button></div>
      <div class="modal-body">
        <div class="form-status" id="formStatus"></div>
        <form id="inquiryForm" onsubmit="submitInquiry(event)">
          <input type="hidden" name="_subject" value="[í¬ë£¨ì¦ˆë§í¬] ìƒˆ ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤">
          <input type="hidden" name="_template" value="table">
          <input type="text" name="_honey" style="display:none">
          <div class="form-group"><label>ì˜ë¬¸ ì´ë¦„ (ì—¬ê¶Œ ê¸°ì¬ëª…) <span class="req">*</span></label><input type="text" name="customer_name" required placeholder="HONG GILDONG"></div>
          <div class="form-group"><label>ì´ë©”ì¼ <span class="req">*</span></label><input type="email" name="customer_email" required placeholder="example@email.com"></div>
          <div class="form-group"><label>ì—°ë½ì²˜ <span class="req">*</span></label><input type="tel" name="customer_phone" required placeholder="010-1234-5678"></div>
          <div class="form-group"><label>ê´€ì‹¬ í¬ë£¨ì¦ˆ / ìš”ì²­ì‚¬í•­ <span class="req">*</span></label><textarea name="message" rows="3" required placeholder="ê´€ì‹¬ ìˆëŠ” í¬ë£¨ì¦ˆë‚˜ ì—¬í–‰ ì¼ì •ì„ ì•Œë ¤ì£¼ì„¸ìš”."></textarea></div>
          <div class="privacy-section">
            <div class="privacy-check"><input type="checkbox" id="privacyAgree3" required><label for="privacyAgree3">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</label></div>
            <button type="button" class="privacy-toggle" onclick="document.getElementById('privacyDetail').classList.toggle('open')">ì•½ê´€ ë³´ê¸° â–¼</button>
            <div class="privacy-detail" id="privacyDetail"><strong>ìˆ˜ì§‘í•­ëª©:</strong> ì´ë¦„, ì´ë©”ì¼, ì—°ë½ì²˜<br><strong>ìˆ˜ì§‘ëª©ì :</strong> í¬ë£¨ì¦ˆ ìƒë‹´ ë° ì˜ˆì•½ ì•ˆë‚´<br><strong>ë³´ìœ ê¸°ê°„:</strong> ìƒë‹´ ì™„ë£Œ í›„ 1ë…„</div>
          </div>
          <button type="submit" class="btn btn-orange" id="submitBtn" style="width:100%;margin-top:16px;padding:14px;font-size:1.05rem">ë¬¸ì˜í•˜ê¸° ì „ì†¡</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    function openInquiryWith(title, operator, ship, dateFrom, nights, price, ref, currency) {
      document.getElementById('modalProductName').textContent = title;
      document.getElementById('modalProductDetail').innerHTML =
        `${operator} Â· ${ship}<br>ì¶œë°œ: ${dateFrom} / ${nights}ë°•${price ? (currency==='EUR'?' / â‚¬':' / $')+price+'~' : ''}`;
      document.getElementById('f_product').value = title;
      document.getElementById('f_cruiseline').value = operator;
      document.getElementById('f_ship').value = ship;
      document.getElementById('f_date').value = dateFrom;
      document.getElementById('f_ports').value = '';
      document.getElementById('f_price').value = price ? (currency==='EUR'?'â‚¬':'$')+price+'~' : 'ë¬¸ì˜';
      document.getElementById('f_ref').value = ref;
      document.getElementById('inquiryModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function openInquiry() {
      document.getElementById('modalProductName').textContent = '';
      document.getElementById('modalProductDetail').innerHTML = '';
      document.getElementById('f_product').value = '';
      document.getElementById('f_cruiseline').value = '';
      document.getElementById('f_ship').value = '';
      document.getElementById('f_date').value = '';
      document.getElementById('f_ports').value = '';
      document.getElementById('f_price').value = '';
      document.getElementById('f_ref').value = '';
      document.getElementById('inquiryModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeInquiry() {
      document.getElementById('inquiryModal').classList.remove('open');
      document.body.style.overflow = '';
    }
    document.addEventListener('click', e => { if (e.target.id === 'inquiryModal') closeInquiry(); });
    function submitInquiry(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true; btn.textContent = 'ì „ì†¡ ì¤‘...';
      const fd = {
        _subject: `[í¬ë£¨ì¦ˆë§í¬] ${document.getElementById('f_product').value} - ${document.getElementById('f_name').value}ë‹˜`,
        _template: 'table',
        'í¬ë£¨ì¦ˆ ìƒí’ˆ': document.getElementById('f_product').value,
        'ì„ ì‚¬': document.getElementById('f_cruiseline').value,
        'ì„ ë°•': document.getElementById('f_ship').value,
        'ì¶œë°œì¼': document.getElementById('f_date').value,
        'ì°¸ê³ ê°€ê²©': document.getElementById('f_price').value,
        'Ref': document.getElementById('f_ref').value,
        'ê³ ê° ì´ë¦„': document.getElementById('f_name').value,
        'ê³ ê° ì´ë©”ì¼': document.getElementById('f_email').value,
        'ê³ ê° ì—°ë½ì²˜': document.getElementById('f_phone').value,
        'ì¸ì›': document.getElementById('f_pax').value,
        'í¬ë§ ê°ì‹¤': document.getElementById('f_cabin').value,
        'ìš”ì²­ì‚¬í•­': document.getElementById('f_message').value || 'ì—†ìŒ',
      };
      const data = new FormData();
      Object.entries(fd).forEach(([k,v]) => data.append(k,v));
      fetch('https://formsubmit.co/ajax/info@cruiselink.co.kr', { method:'POST', body:data })
      .then(() => {
        document.getElementById('formStatus').innerHTML = '<div style="background:#e8f5e9;padding:12px;border-radius:8px;color:#2e7d32;font-size:0.9rem">âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ê²¬ì ì„œë¥¼ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('inquiryForm').style.display = 'none'; btn.style.display = 'none';
      }).catch(() => {
        document.getElementById('formStatus').innerHTML = '<div style="background:#e8f5e9;padding:12px;border-radius:8px;color:#2e7d32;font-size:0.9rem">âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ê²¬ì ì„œë¥¼ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('inquiryForm').style.display = 'none'; btn.style.display = 'none';
      });
    }
  </script>
  <div class="modal-overlay" id="inquiryModal">
    <div class="modal" style="max-width:460px">
      <div class="modal-header" style="padding:14px 20px">
        <h2 style="font-size:1.05rem">ğŸš¢ í¬ë£¨ì¦ˆ ë¬¸ì˜í•˜ê¸°</h2>
        <button class="modal-close" onclick="closeInquiry()">&times;</button>
      </div>
      <div class="modal-body" style="padding:16px 20px">
        <div class="modal-product-info" style="padding:10px 12px;margin-bottom:12px;font-size:0.88rem;background:#f5f5f5;border-radius:8px">
          <strong id="modalProductName"></strong><br>
          <span id="modalProductDetail" style="color:#666"></span>
        </div>
        <div class="form-status" id="formStatus"></div>
        <form id="inquiryForm" onsubmit="submitInquiry(event)">
          <input type="hidden" id="f_product" name="product_name">
          <input type="hidden" id="f_cruiseline" name="cruise_line">
          <input type="hidden" id="f_ship" name="ship">
          <input type="hidden" id="f_date" name="departure_date">
          <input type="hidden" id="f_ports" name="ports">
          <input type="hidden" id="f_price" name="price">
          <input type="hidden" id="f_ref" name="cruise_ref">
          <input type="text" name="_honey" style="display:none">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì´ë¦„ <span class="req">*</span></label>
              <input type="text" id="f_name" name="customer_name" required placeholder="í™ê¸¸ë™" style="padding:8px 10px;font-size:0.9rem">
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì—°ë½ì²˜ <span class="req">*</span></label>
              <input type="tel" id="f_phone" name="customer_phone" required placeholder="010-1234-5678" style="padding:8px 10px;font-size:0.9rem">
            </div>
          </div>
          <div class="form-group" style="margin-bottom:8px">
            <label style="font-size:0.8rem;margin-bottom:3px">ì´ë©”ì¼ <span class="req">*</span></label>
            <input type="email" id="f_email" name="customer_email" required placeholder="example@email.com" style="padding:8px 10px;font-size:0.9rem">
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì¸ì› <span class="req">*</span></label>
              <select id="f_pax" name="pax" required style="padding:8px 10px;font-size:0.9rem">
                <option value="">ì„ íƒ</option>
                <option value="1">1ëª…</option><option value="2">2ëª…</option><option value="3">3ëª…</option>
                <option value="4">4ëª…</option><option value="5">5ëª…</option><option value="6~10">6~10ëª…</option>
                <option value="11+">11ëª… ì´ìƒ</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ê°ì‹¤ íƒ€ì… <span class="req">*</span></label>
              <select id="f_cabin" name="cabin_type" required style="padding:8px 10px;font-size:0.9rem">
                <option value="">ì„ íƒ</option>
                <option value="ë‚´ì¸¡">ë‚´ì¸¡</option>
                <option value="ì˜¤ì…˜ë·°">ì˜¤ì…˜ë·°</option>
                <option value="ë°œì½”ë‹ˆ">ë°œì½”ë‹ˆ</option>
                <option value="ìŠ¤ìœ„íŠ¸">ìŠ¤ìœ„íŠ¸</option>
              </select>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:8px">
            <label style="font-size:0.8rem;margin-bottom:3px">ìš”ì²­ì‚¬í•­</label>
            <textarea id="f_message" name="message" rows="2" placeholder="ê¸°íƒ€ ìš”ì²­ì‚¬í•­" style="padding:8px 10px;font-size:0.9rem"></textarea>
          </div>
          <div class="privacy-section" style="margin-top:8px;padding-top:8px">
            <div class="privacy-check" style="margin-bottom:4px">
              <input type="checkbox" id="privacyAgree" required style="width:16px;height:16px">
              <label for="privacyAgree" style="font-size:0.8rem">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</label>
            </div>
            <button type="button" class="privacy-toggle" style="font-size:0.78rem" onclick="document.getElementById('privacyDetail').classList.toggle('open')">ì•½ê´€ ë³´ê¸° â–¼</button>
            <div class="privacy-detail" id="privacyDetail">
              <strong>ìˆ˜ì§‘í•­ëª©:</strong> ì´ë¦„, ì´ë©”ì¼, ì—°ë½ì²˜<br>
              <strong>ìˆ˜ì§‘ëª©ì :</strong> í¬ë£¨ì¦ˆ ìƒë‹´ ë° ì˜ˆì•½ ì•ˆë‚´<br>
              <strong>ë³´ìœ ê¸°ê°„:</strong> ìƒë‹´ ì™„ë£Œ í›„ 1ë…„
            </div>
          </div>
          <button type="submit" class="btn btn-orange" id="submitBtn" style="width:100%;margin-top:10px;padding:12px;font-size:1rem">ë¬¸ì˜í•˜ê¸° ì „ì†¡</button>
        </form>
      </div>
    </div>
  </div>

</body>
</html>
