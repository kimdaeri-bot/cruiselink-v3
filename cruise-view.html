<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í¬ë£¨ì¦ˆ ìƒì„¸ - í¬ë£¨ì¦ˆë§í¬</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš¢</text></svg>">
</head>
<body>
  <div id="header"></div>
  <div id="content">
    <div class="loading" style="padding:100px 20px"><div class="loading-spinner"></div><p>í¬ë£¨ì¦ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
  </div>
  <div id="footer"></div>

  <script src="assets/data/translations.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/components.js"></script>
  <script>
    document.getElementById('header').innerHTML = Components.header();
    document.getElementById('footer').innerHTML = Components.footer();

    const ref = new URLSearchParams(location.search).get('ref');
    if (!ref) {
      document.getElementById('content').innerHTML = '<div class="empty-state"><span class="emoji">âš ï¸</span><p>ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤</p></div>';
    }

    function stripHtml(html) {
      const tmp = document.createElement('div');
      tmp.innerHTML = html || '';
      return tmp.textContent || '';
    }

    function fmtPrice(v) {
      if (!v) return '-';
      return '$' + parseFloat(v).toLocaleString('en-US', {minimumFractionDigits:0, maximumFractionDigits:0});
    }

    async function load() {
      if (!ref) return;
      const content = document.getElementById('content');

      // 1) Load local cruise data for immediate render
      const cruises = await API.loadLocalCruises();
      const localCruise = cruises.find(c => c.ref === ref);

      // 2) Load ship details from local JSON
      const ships = await API.loadLocalShips();
      const localShip = localCruise ? ships.find(s => s.slug === localCruise.shipSlug) : null;
      const shipDetail = localCruise ? await API.getShipDetail(localCruise.shipSlug) : null;

      // Render immediately with local data
      if (localCruise && localShip) {
        renderPage(localCruise, localShip, shipDetail, null);
        initAllSliders();
      }

      // 3) Fetch live itinerary from API
      try {
        const holiday = await API.getHoliday(ref);
        if (holiday) {
          if (localCruise && localShip) {
            renderItinerary(holiday);
            renderPricing(holiday, shipDetail);
          } else {
            // No local data - render from API only
            renderFromAPI(holiday, shipDetail);
          }
        } else if (!localCruise) {
          content.innerHTML = '<div class="empty-state"><span class="emoji">âš ï¸</span><p>í¬ë£¨ì¦ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p></div>';
        }
      } catch (e) {
        console.error('API fetch failed:', e);
        if (!localCruise) {
          content.innerHTML = '<div class="empty-state"><span class="emoji">âš ï¸</span><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p></div>';
        }
      }
    }

    function renderPage(c, ship, detail, holiday) {
      window._cruiseData = c;
      const nights = c.nights;
      const fromPrice = c.priceBalcony || c.priceOutside || c.priceInside;
      const priceStr = fromPrice ? API.formatPrice(fromPrice, c.currency) : 'ë¬¸ì˜';
      const countries = (c.countriesKo || []).join(', ') || (c.countries || []).join(', ');

      document.title = `${c.title} - í¬ë£¨ì¦ˆë§í¬`;

      let html = '';

      // === HERO ===
      html += `
      <section class="detail-hero">
        <div class="container">
          <div class="operator-name">${Translations.operatorName(c.operator)} Â· ${c.shipTitleKo || Translations.shipName(c.shipTitle)}</div>
          <h1>ğŸš¢ ${c.title}</h1>
          <div class="meta">
            <span>ğŸ“… ${API.formatDateKo(c.dateFrom)} ~ ${API.formatDateKo(c.dateTo)}</span>
            <span>ğŸŒ™ ${nights}ë°• ${nights+1}ì¼</span>
            <span>ğŸš¢ ${c.shipTitleKo || c.shipTitle}</span>
            <span>ğŸŒ ${countries}</span>
          </div>
          <div class="detail-hero-tags">
            ${(c.hashtags||[]).slice(0,6).map(t => `<span class="hero-tag">${t}</span>`).join('')}
          </div>
          <div class="price-big">${priceStr} <small>/1ì¸ 2ì¸ê¸°ì¤€</small></div>
          <div class="hero-ctas cta-two-center">
            <a href="https://pf.kakao.com/_xgYbJG" target="_blank" class="btn btn-orange">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ìƒë‹´</a>
            <button class="btn btn-white-solid" onclick="openInquiry()">ğŸ“‹ ì˜¨ë¼ì¸ ë¬¸ì˜</button>
          </div>
        </div>
      </section>`;

      // === MAIN SHIP IMAGE ===
      if (ship.coverImage) {
        html += `<div class="container"><div class="main-ship-image"><img src="${ship.coverImage}" alt="${c.shipTitle}" loading="lazy"></div></div>`;
      }

      // === INFO BAR ===
      html += `
      <div class="container">
        <div class="info-bar">
          <div class="info-bar-item"><div class="label">ğŸš¢ ì„ ë°•</div><div class="value">${c.shipTitleKo || c.shipTitle}</div></div>
          <div class="info-bar-item"><div class="label">ğŸŒ™ ê¸°ê°„</div><div class="value">${nights}ë°• ${nights+1}ì¼</div></div>
          <div class="info-bar-item"><div class="label">ğŸšª ì¶œë°œ/ë„ì°©</div><div class="value">${c.startsAt?.nameKo || c.startsAt?.name || ''} â†’ ${c.endsAt?.nameKo || c.endsAt?.name || ''}</div></div>
          <div class="info-bar-item"><div class="label">ğŸ’° 2ì¸1ì‹¤ ê¸°ì¤€</div><div class="value" style="color:var(--orange)">${priceStr}</div></div>
        </div>
      </div>`;

      // === ITINERARY PLACEHOLDER ===
      html += `
      <section class="section" id="itinerary-section">
        <div class="container">
          <h2 class="section-title">ğŸ—“ï¸ ìƒì„¸ ì¼ì •</h2>
          <p class="section-subtitle">${c.portRoute || ''}</p>
          <div id="day-cards-container">
            <div class="loading"><div class="loading-spinner"></div><p>ì¼ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
          </div>
        </div>
      </section>`;

      // === SHIP INFO ===
      html += renderShipSection(c, ship, detail);

      // === PRICING PLACEHOLDER ===
      html += `<section class="section" id="pricing-section"></section>`;

      // === INCLUDE/EXCLUDE ===
      html += `
      <section class="section" style="background:var(--gray-50)">
        <div class="container">
          <h2 class="section-title">ğŸ“‹ í¬í•¨ / ë¶ˆí¬í•¨ ì‚¬í•­</h2>
          <div class="checklist-grid" style="margin-top:24px;max-width:700px;margin-left:auto;margin-right:auto">
            <div>
              <h3 style="color:var(--navy);margin-bottom:16px">âœ… í¬í•¨ ì‚¬í•­</h3>
              <ul class="checklist included">
                <li>ê°ì‹¤ ìˆ™ë°•</li>
                <li>ë©”ì¸ ë ˆìŠ¤í† ë‘ & ë·”í˜ ì‹ì‚¬ (ì¡°ì‹Â·ì¤‘ì‹Â·ì„ì‹)</li>
                <li>ì„ ìƒ ì—”í„°í…Œì¸ë¨¼íŠ¸ (ì‡¼, ê³µì—°, ìˆ˜ì˜ì¥)</li>
                <li>í”¼íŠ¸ë‹ˆìŠ¤ ì„¼í„°</li>
                <li>í‚¤ì¦ˆ & í‹´ì¦ˆ í´ëŸ½ í”„ë¡œê·¸ë¨</li>
                <li>ê°ì‹¤ ë£¸ì„œë¹„ìŠ¤ (ê¸°ë³¸)</li>
                <li>ê¸°í•­ì§€ ì…”í‹€ë²„ìŠ¤ (ì¼ë¶€)</li>
              </ul>
            </div>
            <div>
              <h3 style="color:var(--navy);margin-bottom:16px">âŒ ë¶ˆí¬í•¨ ì‚¬í•­</h3>
              <ul class="checklist excluded">
                <li>í•­ê³µí¸</li>
                <li>ìŠ¤í˜ì…œí‹° ë ˆìŠ¤í† ë‘</li>
                <li>ì£¼ë¥˜ ë° ìŒë£Œ íŒ¨í‚¤ì§€</li>
                <li>ê¸°í•­ì§€ ê´€ê´‘ (Shore Excursion)</li>
                <li>ìŠ¤íŒŒ & ë·°í‹° íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸</li>
                <li>Wi-Fi ì¸í„°ë„· íŒ¨í‚¤ì§€</li>
                <li>ì„¸íƒ ì„œë¹„ìŠ¤</li>
                <li>ì—¬í–‰ì ë³´í—˜</li>
              </ul>
            </div>
          </div>
        </div>
      </section>`;

      // === CTA ===
      html += `
      <section class="cta-section">
        <div class="container">
          <h2>ì´ í¬ë£¨ì¦ˆê°€ ë§ˆìŒì— ë“œì…¨ë‚˜ìš”?</h2>
          <p>í¬ë£¨ì¦ˆë§í¬ ì „ë¬¸ ìƒë‹´ì›ì´ ìµœì ì˜ ê°ì‹¤ê³¼ ê°€ê²©ì„ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤.</p>
          <div class="cta-buttons cta-two">
            <a href="https://pf.kakao.com/_xgYbJG" target="_blank" class="btn btn-orange">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ìƒë‹´</a>
            <button class="btn btn-white-solid" onclick="openInquiry()">ğŸ“‹ ì˜¨ë¼ì¸ ë¬¸ì˜</button>
          </div>
        </div>
      </section>`;

      content.innerHTML = html;
    }

    function renderShipSection(c, ship, detail) {
      let html = `
      <section class="section" style="background:var(--gray-50)">
        <div class="container">
          <h2 class="section-title">ğŸš¢ ${c.shipTitleKo || c.shipTitle} ì†Œê°œ</h2>
          ${(() => { const teaser = Translations.shipTeaser(c.shipTitle, c.shipTitleKo, c.operator, ship.shipClass, ship.capacity, ship.launchYear); return teaser ? `<p class="section-subtitle" style="max-width:800px;margin:0 auto 24px;text-align:center">${teaser}</p>` : ''; })()}

          <div class="spec-grid">`;

      const specs = [
        ['ì·¨í•­ì—°ë„', ship.launchYear || '-'],
        ['ì´í†¤ìˆ˜', ship.grossTonnage ? ship.grossTonnage.toLocaleString() + 't' : '-'],
        ['ìµœëŒ€ì •ì›', ship.capacity ? ship.capacity.toLocaleString() + 'ëª…' : '-'],
        ['ìŠ¹ë¬´ì›', ship.crewCount ? ship.crewCount.toLocaleString() + 'ëª…' : '-'],
        ['ì „ì¥', ship.length ? ship.length + 'm' : '-'],
        ['ì „í­', ship.width ? ship.width + 'm' : '-'],
        ['ë°í¬', ship.deckCount ? ship.deckCount + 'ê°œ' : '-'],
        ['ê°ì‹¤', ship.cabinCount ? ship.cabinCount.toLocaleString() + 'ì‹¤' : '-'],
      ];
      specs.forEach(([label, value]) => {
        html += `<div class="spec-item"><div class="spec-value">${value}</div><div class="spec-label">${label}</div></div>`;
      });
      html += `</div>`;

      // Facility tabs from ships-detail.json
      if (detail) {
        const tabs = [];
        if (detail.dining?.length) tabs.push({id:'dining', label:`ğŸ½ï¸ ë‹¤ì´ë‹ (${detail.dining.length})`, items: detail.dining});
        if (detail.entertainment?.length) tabs.push({id:'ent', label:`ğŸ­ ì—”í„°í…Œì¸ë¨¼íŠ¸ (${detail.entertainment.length})`, items: detail.entertainment});
        if (detail.health?.length) tabs.push({id:'health', label:`ğŸ’† ìŠ¤íŒŒÂ·í”¼íŠ¸ë‹ˆìŠ¤ (${detail.health.length})`, items: detail.health});
        if (detail.kids?.length) tabs.push({id:'kids', label:`ğŸ‘¶ í‚¤ì¦ˆ (${detail.kids.length})`, items: detail.kids});
        if (detail.deckplans?.length) tabs.push({id:'decks', label:`ğŸ“ ë±í”Œëœ (${detail.deckplans.length})`, items: detail.deckplans});

        if (tabs.length) {
          html += `<div class="ship-tabs" style="margin-top:40px">`;
          html += `<div class="tabs">`;
          tabs.forEach((t, i) => {
            html += `<button class="tab-btn ${i===0?'active':''}" onclick="switchShipTab(this,'ship-panel-${t.id}')">${t.label}</button>`;
          });
          html += `</div>`;

          tabs.forEach((t, i) => {
            const sliderId = 'slider-' + t.id;
            const items = t.id === 'decks' ? t.items : t.items.slice(0, 12);
            html += `<div class="tab-content ${i===0?'active':''}" id="ship-panel-${t.id}">`;
            html += `<div class="facility-slider" id="${sliderId}">`;
            html += `<div class="facility-slides">`;
            items.forEach(item => {
              const tr = Translations.facilityKo[item.name];
              const name = tr ? tr.name : item.name;
              const desc = tr ? tr.desc : null;
              html += `<div class="facility-slide">`;
              html += item.image ? `<img src="${item.image}" alt="${name}" loading="lazy">` : '';
              html += `<div class="facility-slide-body"><div class="facility-slide-name">${name}</div>`;
              if (desc) html += `<div class="facility-slide-desc">${desc}</div>`;
              html += `</div></div>`;
            });
            html += `</div>`;
            if (items.length > 1) {
              html += `<button class="slider-btn slider-prev">â—€</button><button class="slider-btn slider-next">â–¶</button>`;
              html += `<div class="slider-dots">${items.map((_, idx) => `<button class="slider-dot${idx===0?' active':''}" data-idx="${idx}"></button>`).join('')}</div>`;
            }
            html += `</div></div>`;
          });
          html += `</div>`;
        }

        // Cabin preview
        if (detail.accommodations?.length) {
          html += `<h3 style="font-size:1.2rem;font-weight:700;color:var(--navy);margin:40px 0 16px">ğŸ›ï¸ ê°ì‹¤ íƒ€ì…</h3>`;
          html += `<div class="cabin-grid">`;
          detail.accommodations.slice(0, 8).forEach(a => {
            html += `<div class="cabin-card">${a.image ? `<img src="${a.image}" alt="${a.name}" loading="lazy">` : ''}<div class="cabin-card-body"><h4>${Translations.accommodationName(a.name)}</h4></div></div>`;
          });
          html += `</div>`;
        }
      }

      html += `</div></section>`;
      return html;
    }

    function renderItinerary(holiday) {
      const container = document.getElementById('day-cards-container');
      if (!container || !holiday.itinerary?.days) {
        if (container) container.innerHTML = '<p style="text-align:center;color:#999">ì¼ì • ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      let html = '<div class="day-cards">';
      for (const day of holiday.itinerary.days) {
        const loc = day.locations?.[0];
        const isSeaDay = !loc || day.day_type?.includes('SEA') || day.day_name?.toLowerCase().includes('at sea');

        if (isSeaDay) {
          html += `
          <div class="day-card sea-day">
            <div class="day-card-header">
              <span class="day-num">DAY ${day.day}</span>
              <span class="day-port">ğŸŒŠ ì¢…ì¼ í•­í•´</span>
              <span class="day-time"></span>
            </div>
            <div class="day-card-body" style="text-align:center;color:var(--gray-500)">
              <p>ì˜¤ëŠ˜ì€ ì¢…ì¼ í•­í•´ì¼ì…ë‹ˆë‹¤. ìˆ˜ì˜ì¥, ìŠ¤íŒŒ, ì¹´ì§€ë…¸, ë ˆìŠ¤í† ë‘ ë“± ì„ ë°•ì˜ ë‹¤ì–‘í•œ ì‹œì„¤ê³¼ ì—”í„°í…Œì¸ë¨¼íŠ¸ë¥¼ ì¦ê¸°ë©° í¸ì•ˆí•œ í•˜ë£¨ë¥¼ ë³´ë‚´ì„¸ìš”.</p>
            </div>
          </div>`;
        } else {
          const portName = Translations.portName(loc.name);
          const countryName = Translations.countryName(loc.country);
          const arrTime = loc.arrival_time || '';
          const depTime = loc.departure_time || '';
          const timeStr = arrTime && depTime ? `${arrTime} ì…í•­ ~ ${depTime} ì¶œí•­` : depTime ? `${depTime} ì¶œí•­` : arrTime ? `${arrTime} ì…í•­` : '';
          const portImages = loc.widgety_data?.images || loc.operator_data?.images || [];
          const mainImg = portImages[0]?.href;
          const descKo = Translations.portDesc(loc.name);
          const desc = descKo || `ì•„ë¦„ë‹¤ìš´ ê¸°í•­ì§€ ${portName}ì—ì„œ íŠ¹ë³„í•œ ì‹œê°„ì„ ë³´ë‚´ì„¸ìš”.`;

          html += `
          <div class="day-card">
            <div class="day-card-header">
              <span class="day-num">DAY ${day.day}</span>
              <span class="day-port">ğŸ“ ${portName}${countryName ? ', ' + countryName : ''}</span>
              <span class="day-time">${timeStr ? 'â° ' + timeStr : ''}</span>
            </div>
            ${mainImg ? `<div class="day-card-img-wrap"><img src="${mainImg}" alt="${portName}" class="day-card-main-img" loading="lazy"></div>` : ''}
            <div class="day-card-body">
              ${desc ? `<p class="port-desc">${desc}</p>` : ''}
            </div>
          </div>`;
        }
      }
      html += '</div>';
      container.innerHTML = html;
    }

    function renderPricing(holiday, shipDetail) {
      const section = document.getElementById('pricing-section');
      if (!section) return;

      const prices = holiday.headline_prices?.cruise;
      if (!prices) return;

      const double = prices.double;
      const single = prices.single;
      const triple = prices.triple;

      let html = `
      <div class="container">
        <h2 class="section-title">ğŸ’° ê°ì‹¤ & ìš”ê¸ˆ</h2>
        <p class="section-subtitle">1ì¸ ê¸°ì¤€ ìš”ê¸ˆ (2ì¸ 1ì‹¤ ê¸°ì¤€, ì„¸ê¸ˆ/í•­ë§Œë£Œ ë³„ë„)</p>
        <table class="price-table">
          <thead><tr><th>ê°ì‹¤ íƒ€ì…</th><th>2ì¸ 1ì‹¤</th><th>1ì¸ 1ì‹¤</th><th>3ì¸ 1ì‹¤</th></tr></thead>
          <tbody>`;

      const types = [
        {key:'inside', label:'ğŸšª ë‚´ì¸¡ (Inside)'},
        {key:'outside', label:'ğŸªŸ ì˜¤ì…˜ë·° (Outside)'},
        {key:'balcony', label:'ğŸŒ… ë°œì½”ë‹ˆ (Balcony)'},
        {key:'suite', label:'ğŸ‘‘ ìŠ¤ìœ„íŠ¸ (Suite)'},
      ];
      types.forEach(t => {
        const dp = double?.['from_' + t.key];
        const sp = single?.['from_' + t.key];
        const tp = triple?.['from_' + t.key];
        if (dp || sp || tp) {
          html += `<tr><td class="room-type">${t.label}</td><td style="color:var(--orange);font-weight:700">${fmtPrice(dp)}</td><td>${fmtPrice(sp)}</td><td>${fmtPrice(tp)}</td></tr>`;
        }
      });

      html += `</tbody></table>
        <p style="margin-top:12px;font-size:0.85rem;color:var(--gray-500)">â€» ìš”ê¸ˆì€ ì˜ˆê³  ì—†ì´ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •í™•í•œ ìš”ê¸ˆì€ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
      </div>`;

      section.innerHTML = html;
    }

    function renderFromAPI(holiday, shipDetail) {
      window._cruiseData = { title: holiday.title, operator: holiday.operator?.title, shipTitle: holiday.ship?.title, departureDate: holiday.departs, nights: holiday.cruise_nights || holiday.duration_days };
      // Fallback: render entirely from API data (no local cruise found)
      const nights = holiday.cruise_nights || holiday.duration_days || 0;
      const price = holiday.headline_prices?.cruise?.double;
      const fromPrice = price?.from_balcony || price?.from_inside;
      const priceStr = fromPrice ? API.formatPrice(fromPrice) : 'ë¬¸ì˜';
      const countries = (holiday.countries || []).map(c => Translations.countryName(c)).join(', ');
      const route = API.routeString(holiday.itinerary);

      document.title = `${Translations.portName(holiday.starts_at?.name||'')} ì¶œë°œ ${nights}ë°• í¬ë£¨ì¦ˆ - í¬ë£¨ì¦ˆë§í¬`;

      let html = `
      <section class="detail-hero">
        <div class="container">
          <div class="operator-name">${Translations.operatorName(holiday.operator_title||'')} Â· ${Translations.shipName(holiday.ship_title||'')}</div>
          <h1>ğŸš¢ ${Translations.portName(holiday.starts_at?.name||'')} ì¶œë°œ ${nights}ë°• í¬ë£¨ì¦ˆ</h1>
          <div class="meta">
            <span>ğŸ“… ${API.formatDateKo(holiday.date_from)} ~ ${API.formatDateKo(holiday.date_to)}</span>
            <span>ğŸŒ™ ${nights}ë°• ${parseInt(nights)+1}ì¼</span>
            <span>ğŸš¢ ${holiday.ship_title||''}</span>
            <span>ğŸŒ ${countries}</span>
          </div>
          <div class="price-big">${priceStr} <small>/1ì¸ 2ì¸ê¸°ì¤€</small></div>
          <div class="hero-ctas cta-two-center">
            <a href="https://pf.kakao.com/_xgYbJG" target="_blank" class="btn btn-orange">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ìƒë‹´</a>
            <button class="btn btn-white-solid" onclick="openInquiry()">ğŸ“‹ ì˜¨ë¼ì¸ ë¬¸ì˜</button>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="container">
          <h2 class="section-title">ğŸ—“ï¸ ìƒì„¸ ì¼ì •</h2>
          <p class="section-subtitle">${route}</p>
          <div id="day-cards-container"></div>
        </div>
      </section>

      <section class="section" id="pricing-section"></section>

      <section class="cta-section">
        <div class="container">
          <h2>ì´ í¬ë£¨ì¦ˆê°€ ë§ˆìŒì— ë“œì…¨ë‚˜ìš”?</h2>
          <p>í¬ë£¨ì¦ˆë§í¬ ì „ë¬¸ ìƒë‹´ì›ì´ ìµœì ì˜ ê°ì‹¤ê³¼ ê°€ê²©ì„ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤.</p>
          <div class="cta-buttons cta-two">
            <a href="https://pf.kakao.com/_xgYbJG" target="_blank" class="btn btn-orange">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ìƒë‹´</a>
            <button class="btn btn-white-solid" onclick="openInquiry()">ğŸ“‹ ì˜¨ë¼ì¸ ë¬¸ì˜</button>
          </div>
        </div>
      </section>`;

      content.innerHTML = html;
      renderItinerary(holiday);
      renderPricing(holiday, shipDetail);
    }

    function initSlider(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;
      const slides = container.querySelector('.facility-slides');
      const dots = container.querySelectorAll('.slider-dot');
      const total = dots.length;
      if (total === 0) return;
      let current = 0;
      function goTo(i) {
        current = (i + total) % total;
        slides.style.transform = `translateX(-${current * 100}%)`;
        dots.forEach((d, idx) => d.classList.toggle('active', idx === current));
      }
      container.querySelector('.slider-prev')?.addEventListener('click', () => goTo(current - 1));
      container.querySelector('.slider-next')?.addEventListener('click', () => goTo(current + 1));
      dots.forEach((d, i) => d.addEventListener('click', () => goTo(i)));
    }

    function initAllSliders() {
      document.querySelectorAll('.facility-slider').forEach(el => initSlider(el.id));
    }

    function switchShipTab(el, panelId) {
      el.parentElement.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
      const parent = el.closest('.ship-tabs');
      parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(panelId)?.classList.add('active');
    }

    load();

    /* â”€â”€ Inquiry Modal â”€â”€ */
    function openInquiry() {
      const c = window._cruiseData;
      if (c) {
        const title = c.title || c.titleKo || '';
        const ship = c.shipTitleKo || Translations.shipName(c.shipTitle || '');
        const op = Translations.operatorName(c.operator || '');
        const price = c.priceBalcony || c.priceOutside || c.priceInside;
        const route = c.portRouteKo || c.portRoute || '';
        document.getElementById('modalProductName').textContent = title;
        document.getElementById('modalProductDetail').innerHTML =
          `${op} Â· ${ship}<br>ì¶œë°œ: ${c.dateFrom || c.departureDate || ''} / ${c.nights || ''}ë°•${price ? ' / $'+price+'~' : ''}`;
        document.getElementById('f_product').value = title;
        document.getElementById('f_cruiseline').value = c.operator || '';
        document.getElementById('f_ship').value = ship;
        document.getElementById('f_date').value = c.dateFrom || c.departureDate || '';
        document.getElementById('f_ports').value = route;
        document.getElementById('f_price').value = price ? '$'+price+'~' : 'ë¬¸ì˜';
        document.getElementById('f_ref').value = c.ref || '';
      }
      document.getElementById('inquiryModal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeInquiry() {
      document.getElementById('inquiryModal').classList.remove('open');
      document.body.style.overflow = '';
    }
    document.addEventListener('click', e => {
      if (e.target.id === 'inquiryModal') closeInquiry();
    });
    function submitInquiry(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true; btn.textContent = 'ì „ì†¡ ì¤‘...';

      const form = document.createElement('form');
      form.method = 'POST';
      form.action = 'https://formsubmit.co/ajax/info@cruiselink.co.kr';

      const fd = {
        _subject: `[í¬ë£¨ì¦ˆë§í¬] ${document.getElementById('f_product').value} - ${document.getElementById('f_name').value}ë‹˜`,
        'í¬ë£¨ì¦ˆ ìƒí’ˆ': document.getElementById('f_product').value,
        'ì„ ì‚¬': document.getElementById('f_cruiseline').value,
        'ì„ ë°•': document.getElementById('f_ship').value,
        'ì¶œë°œì¼': document.getElementById('f_date').value,
        'ì¼ì •': document.getElementById('f_ports').value,
        'ì°¸ê³ ê°€ê²©': document.getElementById('f_price').value,
        'Ref': document.getElementById('f_ref').value,
        'ê³ ê° ì´ë¦„': document.getElementById('f_name').value,
        'ê³ ê° ì´ë©”ì¼': document.getElementById('f_email').value,
        'ê³ ê° ì—°ë½ì²˜': document.getElementById('f_phone').value,
        'ì¸ì›': document.getElementById('f_pax').value,
        'í¬ë§ ê°ì‹¤': document.getElementById('f_cabin').value,
        'ìš”ì²­ì‚¬í•­': document.getElementById('f_message').value || 'ì—†ìŒ',
      };

      fetch('https://formsubmit.co/ajax/info@cruiselink.co.kr', {
        method: 'POST',
        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'},
        body: JSON.stringify(fd)
      })
      .then(r => r.json())
      .then(data => {
        document.getElementById('formStatus').innerHTML =
          '<div style="background:#e8f5e9;padding:12px;border-radius:8px;color:#2e7d32;font-size:0.9rem">âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ê²¬ì ì„œë¥¼ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('inquiryForm').style.display = 'none';
        btn.style.display = 'none';
      })
      .catch(() => {
        document.getElementById('formStatus').innerHTML =
          '<div style="background:#e8f5e9;padding:12px;border-radius:8px;color:#2e7d32;font-size:0.9rem">âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ê²¬ì ì„œë¥¼ íšŒì‹ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</div>';
        document.getElementById('inquiryForm').style.display = 'none';
        btn.style.display = 'none';
      });
    }
  </script>

  <!-- Inquiry Modal -->
  <div class="modal-overlay" id="inquiryModal">
    <div class="modal" style="max-width:460px">
      <div class="modal-header" style="padding:14px 20px">
        <h2 style="font-size:1.05rem">ğŸš¢ í¬ë£¨ì¦ˆ ë¬¸ì˜í•˜ê¸°</h2>
        <button class="modal-close" onclick="closeInquiry()">&times;</button>
      </div>
      <div class="modal-body" style="padding:16px 20px">
        <div class="modal-product-info" style="padding:10px 12px;margin-bottom:12px;font-size:0.88rem">
          <strong id="modalProductName"></strong><br>
          <span id="modalProductDetail"></span>
        </div>
        <div class="form-status" id="formStatus"></div>
        <form id="inquiryForm" onsubmit="submitInquiry(event)">
          <input type="hidden" id="f_product" name="product_name">
          <input type="hidden" id="f_cruiseline" name="cruise_line">
          <input type="hidden" id="f_ship" name="ship">
          <input type="hidden" id="f_date" name="departure_date">
          <input type="hidden" id="f_ports" name="ports">
          <input type="hidden" id="f_price" name="price">
          <input type="hidden" id="f_ref" name="cruise_ref">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì´ë¦„ <span class="req">*</span></label>
              <input type="text" id="f_name" name="customer_name" required placeholder="í™ê¸¸ë™" style="padding:8px 10px;font-size:0.9rem">
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì—°ë½ì²˜ <span class="req">*</span></label>
              <input type="tel" id="f_phone" name="customer_phone" required placeholder="010-1234-5678" style="padding:8px 10px;font-size:0.9rem">
            </div>
          </div>
          <div class="form-group" style="margin-bottom:8px">
            <label style="font-size:0.8rem;margin-bottom:3px">ì´ë©”ì¼ <span class="req">*</span></label>
            <input type="email" id="f_email" name="customer_email" required placeholder="example@email.com" style="padding:8px 10px;font-size:0.9rem">
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ì¸ì› <span class="req">*</span></label>
              <select id="f_pax" name="pax" required style="padding:8px 10px;font-size:0.9rem">
                <option value="">ì„ íƒ</option>
                <option value="1">1ëª…</option><option value="2">2ëª…</option><option value="3">3ëª…</option>
                <option value="4">4ëª…</option><option value="5">5ëª…</option><option value="6~10">6~10ëª…</option>
                <option value="11+">11ëª… ì´ìƒ</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label style="font-size:0.8rem;margin-bottom:3px">ê°ì‹¤ íƒ€ì… <span class="req">*</span></label>
              <select id="f_cabin" name="cabin_type" required style="padding:8px 10px;font-size:0.9rem">
                <option value="">ì„ íƒ</option>
                <option value="ë‚´ì¸¡">ë‚´ì¸¡</option>
                <option value="ì˜¤ì…˜ë·°">ì˜¤ì…˜ë·°</option>
                <option value="ë°œì½”ë‹ˆ">ë°œì½”ë‹ˆ</option>
                <option value="ìŠ¤ìœ„íŠ¸">ìŠ¤ìœ„íŠ¸</option>
              </select>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:8px">
            <label style="font-size:0.8rem;margin-bottom:3px">ìš”ì²­ì‚¬í•­</label>
            <textarea id="f_message" name="message" rows="2" placeholder="ê¸°íƒ€ ìš”ì²­ì‚¬í•­" style="padding:8px 10px;font-size:0.9rem"></textarea>
          </div>
          <div class="privacy-section" style="margin-top:8px;padding-top:8px">
            <div class="privacy-check" style="margin-bottom:4px">
              <input type="checkbox" id="privacyAgree" required style="width:16px;height:16px">
              <label for="privacyAgree" style="font-size:0.8rem">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</label>
            </div>
            <button type="button" class="privacy-toggle" style="font-size:0.78rem" onclick="document.getElementById('privacyDetail').classList.toggle('open')">ì•½ê´€ ë³´ê¸° â–¼</button>
            <div class="privacy-detail" id="privacyDetail">
              <strong>ìˆ˜ì§‘í•­ëª©:</strong> ì´ë¦„, ì´ë©”ì¼, ì—°ë½ì²˜<br>
              <strong>ìˆ˜ì§‘ëª©ì :</strong> í¬ë£¨ì¦ˆ ìƒë‹´ ë° ì˜ˆì•½ ì•ˆë‚´<br>
              <strong>ë³´ìœ ê¸°ê°„:</strong> ìƒë‹´ ì™„ë£Œ í›„ 1ë…„
            </div>
          </div>
          <button type="submit" class="btn btn-orange" id="submitBtn" style="width:100%;margin-top:10px;padding:12px;font-size:1rem">ë¬¸ì˜í•˜ê¸° ì „ì†¡</button>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
